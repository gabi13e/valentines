<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Something For You</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Dancing+Script:wght@500;700&family=Jost:wght@200;300;400&display=swap" rel="stylesheet"/>
<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
(function(){
  emailjs.init("1N5ypXBs8B9eVMhcK"); // Your Public Key
})();
</script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --rose:      #e8638a;
  --blush:     #f9d0df;
  --deep:      #c0415f;
  --dusty:     #7a3a50;
  --text:      #4a1a2e;
  --light-txt: #8a4060;
  --glass-bg:  rgba(255,245,250,0.82);
  --glass-bd:  rgba(232,99,138,0.28);
}

html, body { width:100%; height:100%; overflow:hidden; }

body {
  font-family: 'Jost', sans-serif;
  background: #1a0a10;
  display: flex; align-items: center; justify-content: center;
  min-height: 100vh;
  position: relative;
  cursor: none;
}

#cursor {
  position: fixed; z-index: 9999; pointer-events: none;
  width: 12px; height: 12px;
  background: radial-gradient(circle, rgba(232,99,138,0.9) 0%, rgba(232,99,138,0) 100%);
  border-radius: 50%;
  transform: translate(-50%,-50%);
  mix-blend-mode: screen;
}
#cursor-ring {
  position: fixed; z-index: 9998; pointer-events: none;
  width: 28px; height: 28px;
  border: 1.5px solid rgba(232,99,138,0.5);
  border-radius: 50%;
  transform: translate(-50%,-50%);
}

#bg-gradient {
  position: fixed; inset: 0; z-index: 0;
  background: #1a0a10;
  overflow: hidden;
}
.mesh-orb {
  position: absolute; border-radius: 50%; filter: blur(70px); opacity: 0;
  animation: orbFloat linear infinite;
}
@keyframes orbFloat {
  0%   { opacity:0; transform:translate(0,0) scale(1); }
  10%  { opacity:1; }
  90%  { opacity:1; }
  100% { opacity:0; transform:translate(var(--tx),var(--ty)) scale(var(--ts)); }
}
.orb-1 { width:500px;height:500px;background:radial-gradient(circle,rgba(192,65,95,0.35),transparent);
         top:10%;left:20%; --tx:80px;--ty:60px;--ts:1.2; animation-duration:18s; }
.orb-2 { width:350px;height:350px;background:radial-gradient(circle,rgba(232,99,138,0.25),transparent);
         top:50%;left:60%; --tx:-60px;--ty:-80px;--ts:0.9; animation-duration:14s; animation-delay:-6s; }
.orb-3 { width:280px;height:280px;background:radial-gradient(circle,rgba(249,208,223,0.18),transparent);
         top:70%;left:10%; --tx:40px;--ty:-100px;--ts:1.1; animation-duration:20s; animation-delay:-10s; }

#heartCanvas, #sparkCanvas {
  position: fixed; inset: 0; z-index: 1;
  pointer-events: none; width:100%; height:100%;
}
#sparkCanvas { z-index: 9997; }

#intro {
  position: fixed; inset: 0; z-index: 20;
  display: flex; align-items: center; justify-content: center;
}
.intro-step {
  position: absolute; text-align: center;
  opacity: 0; transform: translateY(18px) scale(0.97);
  transition: opacity .9s cubic-bezier(.22,1,.36,1), transform .9s cubic-bezier(.22,1,.36,1);
  pointer-events: none;
}
.intro-step.active { opacity:1; transform:translateY(0) scale(1); }
.intro-step.exiting { opacity:0; transform:translateY(-18px) scale(1.03); }
.step-label {
  font-family:'Jost'; font-weight:200;
  font-size:clamp(0.7rem,2vw,0.82rem);
  letter-spacing:0.22em; text-transform:uppercase;
  color:rgba(232,99,138,0.7); margin-bottom:16px;
}
.step-main {
  font-family:'Cormorant Garamond',serif; font-weight:300;
  font-size:clamp(2rem,7vw,4.2rem);
  color:#f9d0df; line-height:1.15;
  text-shadow:0 0 60px rgba(232,99,138,0.3);
}
.step-main .name {
  font-family:'Dancing Script',cursive; font-weight:700;
  color:#f7a8c4; font-size:1.25em; display:block;
  text-shadow:0 0 40px rgba(232,99,138,0.5);
}
.step-main .soft {
  font-style:italic; font-weight:300;
  color:rgba(249,208,223,0.8); font-size:0.75em;
}

#card {
  position: relative; z-index: 15;
  background: var(--glass-bg);
  backdrop-filter: blur(24px) saturate(1.4);
  border: 1px solid var(--glass-bd);
  border-radius: 28px;
  padding: clamp(36px,6vw,60px) clamp(32px,6vw,68px) clamp(32px,5vw,52px);
  max-width: 540px; width: 92vw;
  text-align: center;
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.12) inset,
    0 12px 60px rgba(0,0,0,0.4),
    0 2px 12px rgba(232,99,138,0.2);
  opacity: 0;
  transform: translateY(30px) scale(0.97);
  transition: opacity .8s cubic-bezier(.22,1,.36,1), transform .8s cubic-bezier(.22,1,.36,1);
  overflow: hidden;
}
#card.visible {
  opacity: 1; transform: translateY(0) scale(1);
  animation: cardDrift 7s 1s ease-in-out infinite;
}
@keyframes cardDrift {
  0%,100%{ transform:translateY(0) rotate(0deg); }
  33%    { transform:translateY(-7px) rotate(0.3deg); }
  66%    { transform:translateY(-4px) rotate(-0.2deg); }
}

#cardTrailCanvas {
  position: absolute; inset: 0; z-index: 1;
  pointer-events: none; border-radius: 28px;
  width: 100%; height: 100%;
}

.card-content { position: relative; z-index: 2; }

.card-label {
  font-family:'Jost'; font-weight:200;
  font-size:clamp(0.65rem,1.8vw,0.75rem);
  letter-spacing:0.22em; text-transform:uppercase;
  color:var(--light-txt); margin-bottom:6px;
}
.card-name {
  font-family:'Dancing Script',cursive; font-weight:700;
  font-size:clamp(2.4rem,6vw,3.6rem);
  color:var(--deep); line-height:1;
  text-shadow:0 2px 24px rgba(192,65,95,0.2); margin-bottom:6px;
}
.card-compliment {
  font-family:'Cormorant Garamond',serif; font-style:italic; font-weight:300;
  font-size:clamp(0.85rem,2.2vw,0.98rem);
  color:var(--dusty); margin-bottom:24px;
}
.divider {
  display:flex; align-items:center; gap:12px;
  margin:0 auto 24px; width:80%;
}
.divider::before,.divider::after {
  content:''; flex:1; height:1px;
  background:linear-gradient(90deg,transparent,rgba(232,99,138,0.3),transparent);
}
.divider-heart { color:rgba(232,99,138,0.5); font-size:0.75rem; }

.question-wrap {
  font-family:'Cormorant Garamond',serif; font-weight:400;
  font-size:clamp(1.2rem,3.5vw,1.55rem);
  color:var(--text); line-height:1.6;
  margin-bottom:36px; min-height:4em;
}
#tw-cursor {
  display:inline-block; width:2px; height:1.1em;
  background:var(--rose); margin-left:2px;
  vertical-align:text-bottom;
  animation:blink .85s step-end infinite;
}
@keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0;} }
#tw-cursor.hidden { display:none; }

#btn-zone {
  display:flex; gap:16px;
  justify-content:center; align-items:center;
}
.btn {
  font-family:'Jost'; font-weight:300;
  font-size:clamp(0.88rem,2.2vw,1rem);
  border:none; border-radius:50px;
  padding:clamp(11px,2vw,14px) clamp(24px,4vw,32px);
  letter-spacing:0.06em; cursor:none;
  transition:transform .2s, box-shadow .2s;
}
#yes-btn {
  background:linear-gradient(135deg,#f7a8c4 0%,#e8638a 50%,#c0415f 100%);
  color:#fff;
  animation:yesGlow 3s ease-in-out infinite;
}
@keyframes yesGlow {
  0%,100%{ box-shadow:0 4px 24px rgba(192,65,95,0.45); }
  50%    { box-shadow:0 4px 32px rgba(192,65,95,0.6),0 0 20px 4px rgba(232,99,138,0.2); }
}
#yes-btn:hover { transform:scale(1.07); }
#yes-btn:active{ transform:scale(0.97); }

/* MAYBE BUTTON ‚Äî Fixed position, dodges across ENTIRE PAGE */
#no-btn {
  position: fixed;
  z-index: 100;
  background: rgba(255,235,245,0.55);
  backdrop-filter: blur(6px);
  color: #7a3a50;
  border: 1px solid rgba(232,99,138,0.4);
  transition: left 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), 
              top 0.35s cubic-bezier(0.34, 1.56, 0.64, 1),
              box-shadow .4s, background .4s, border-color .4s;
  white-space: nowrap;
  cursor: none;
  /* Hidden initially until dodge is enabled */
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

#no-btn.active {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

#no-btn.heart-done {
  background: rgba(192,65,95,0.2);
  color: #c0415f;
  border-color: rgba(232,99,138,0.9);
  box-shadow: 0 0 0 3px rgba(232,99,138,0.2), 0 0 24px rgba(232,99,138,0.4);
  animation: doneGlow 2s ease-in-out infinite;
  cursor: pointer;
}
@keyframes doneGlow {
  0%,100%{ box-shadow: 0 0 0 3px rgba(232,99,138,0.15), 0 0 24px rgba(232,99,138,0.3); }
  50%    { box-shadow: 0 0 0 6px rgba(232,99,138,0.1),  0 0 50px rgba(232,99,138,0.5); }
}

#dodge-counter {
  position: fixed; bottom: 28px; left: 50%;
  transform: translateX(-50%);
  z-index: 60;
  font-family:'Jost'; font-weight:300; font-size:0.78rem;
  letter-spacing:0.12em;
  color:rgba(249,208,223,0.7);
  background:rgba(26,10,16,0.6);
  backdrop-filter:blur(8px);
  border:1px solid rgba(232,99,138,0.2);
  border-radius:50px; padding:7px 20px;
  opacity:0; transition:opacity .5s;
}
#dodge-counter.visible { opacity:1; }

#dodge-msg {
  display:none;
  position:fixed; bottom:10vh; left:50%;
  transform:translateX(-50%);
  z-index:70;
  background:rgba(255,248,252,0.12);
  backdrop-filter:blur(16px);
  border:1px solid rgba(232,99,138,0.35);
  border-radius:20px; padding:14px 32px;
  font-family:'Cormorant Garamond',serif; font-style:italic; font-weight:300;
  font-size:clamp(0.9rem,2.5vw,1.1rem);
  color:#f9d0df;
  box-shadow:0 8px 40px rgba(0,0,0,0.3);
  animation:msgRise .8s cubic-bezier(.22,1,.36,1) both;
}
#dodge-msg.visible { display:block; }
@keyframes msgRise {
  from{ opacity:0; transform:translateX(-50%) translateY(20px); }
  to  { opacity:1; transform:translateX(-50%) translateY(0); }
}

#maybe-toast {
  display:none; position:fixed; inset:0; z-index:400;
  align-items:center; justify-content:center;
  background:rgba(10,0,6,0.75);
  backdrop-filter:blur(6px);
}
#maybe-toast.visible { display:flex; animation:fadeIn .4s ease both; }
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

.toast-box {
  background:rgba(255,245,250,0.96);
  border:1px solid rgba(192,65,95,0.25);
  border-radius:24px; padding:44px 52px;
  text-align:center; max-width:400px; width:88vw;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
  animation:toastPop .5s cubic-bezier(.22,1,.36,1) both;
}
@keyframes toastPop {
  from{ opacity:0; transform:scale(.9) translateY(20px); }
  to  { opacity:1; transform:scale(1) translateY(0); }
}
.toast-sad {
  font-size:2.6rem; margin-bottom:16px;
  display:block;
  animation:sadBob 1.8s ease-in-out infinite;
}
@keyframes sadBob {
  0%,100%{ transform:translateY(0) rotate(0deg); }
  30%    { transform:translateY(-6px) rotate(-4deg); }
  60%    { transform:translateY(-2px) rotate(3deg); }
}
.toast-title {
  font-family:'Cormorant Garamond',serif; font-weight:400;
  font-size:clamp(1.2rem,3vw,1.5rem);
  color:#4a1a2e; margin-bottom:10px;
}
.toast-sub {
  font-family:'Jost'; font-weight:300; font-size:0.85rem;
  color:#8a4060; margin-bottom:28px;
}
.toast-reconsider {
  font-family:'Jost'; font-weight:300; font-size:0.78rem;
  letter-spacing:0.12em; text-transform:uppercase;
  color:rgba(192,65,95,0.6); cursor:pointer;
  border:none; background:none; padding:8px 16px;
  transition:color .2s;
}
.toast-reconsider:hover { color:#c0415f; }

#success {
  display:none; position:fixed; inset:0; z-index:300;
  background:linear-gradient(135deg,#1a0a10 0%,#3a0d1e 50%,#1a0a10 100%);
  align-items:center; justify-content:center; flex-direction:column;
  text-align:center; padding:40px;
}
#success.visible { display:flex; animation:successReveal .9s cubic-bezier(.22,1,.36,1) both; }
@keyframes successReveal {
  from{ opacity:0; transform:scale(.94); }
  to  { opacity:1; transform:scale(1); }
}
.success-title {
  font-family:'Dancing Script',cursive; font-weight:700;
  font-size:clamp(2rem,7vw,3.8rem);
  color:#f9d0df;
  text-shadow:0 0 60px rgba(232,99,138,0.5);
  margin-bottom:16px;
}
.success-sub {
  font-family:'Cormorant Garamond',serif; font-style:italic; font-weight:300;
  font-size:clamp(1rem,3vw,1.2rem);
  color:rgba(247,168,196,0.75);
  max-width:380px; line-height:1.75;
}
.success-divider {
  width:80px; height:1px;
  background:linear-gradient(90deg,transparent,rgba(232,99,138,0.5),transparent);
  margin:20px auto;
}

#music-toggle {
  position:fixed; top:22px; right:22px; z-index:500;
  width:38px; height:38px;
  background:rgba(255,248,252,0.1);
  backdrop-filter:blur(8px);
  border:1px solid rgba(232,99,138,0.25);
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  cursor:none; opacity:0; transition:opacity .5s;
  color:rgba(249,208,223,0.7); font-size:0.9rem;
}
#music-toggle.visible { opacity:1; }
#music-toggle.playing { color:#f7a8c4; border-color:rgba(232,99,138,0.5); }

.confetti-bit {
  position:fixed; pointer-events:none; z-index:400;
  border-radius:50%;
}

#shimmer {
  position:fixed; inset:0; z-index:250;
  pointer-events:none; opacity:0;
  background:radial-gradient(ellipse at 50% 50%,rgba(249,208,223,0.12) 0%,transparent 70%);
  transition:opacity .8s;
}
#shimmer.active { opacity:1; }
</style>
</head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>

<div id="bg-gradient">
  <div class="mesh-orb orb-1"></div>
  <div class="mesh-orb orb-2"></div>
  <div class="mesh-orb orb-3"></div>
</div>

<canvas id="heartCanvas"></canvas>
<canvas id="sparkCanvas"></canvas>

<button id="music-toggle" title="Toggle music">‚ô™</button>

<div id="intro">
  <div class="intro-step" id="step-1">
    <div class="step-main">Hi, <span class="name">Chrisly</span></div>
  </div>
  <div class="intro-step" id="step-2">
      <div class="step-label">a little surprise</div>
    <div class="step-main">I made something small<br><span class="soft">thought you might like it‚Ä¶</span></div>
  </div>
  <div class="intro-step" id="step-3">
    <div class="step-main" style="font-size:clamp(1.4rem,4.5vw,2.6rem)">Before I ask you something...</div>
  </div>
</div>

<div id="card">
  <canvas id="cardTrailCanvas"></canvas>
  <div class="card-content">
    <p class="card-label">a note for</p>
    <h1 class="card-name">Chrisly</h1>
    <p class="card-compliment">You somehow make ordinary days‚Ä¶ not so ordinary üòâ</p>
    <div class="divider"><span class="divider-heart">‚ô°</span></div>
    <div class="question-wrap">
      <span id="typewriter-text"></span><span id="tw-cursor"></span>
    </div>
    <div id="btn-zone">
      <button class="btn" id="yes-btn">Yes</button>
      <!-- Placeholder to maintain layout spacing -->
      <div class="btn" style="visibility:hidden;pointer-events:none;">Maybe</div>
    </div>
  </div>
</div>

<!-- Maybe button OUTSIDE card so overflow:hidden doesn't affect it -->
<button class="btn" id="no-btn">Maybe</button>

<div id="dodge-counter">0%</div>
<div id="dodge-msg">hearts are complete‚Ä¶ hope you say yes! üòâ</div>
<div id="shimmer"></div>

<div id="success">
  <div class="success-title">Wait‚Ä¶ that actually worked?</div>
  <div class="success-divider"></div>
  <div class="success-sub">I guess I owe you a pretty good date now.</div>
</div>

<div id="maybe-toast">
  <div class="toast-box">
    <span class="toast-sad">ü•∫</span>
    <div class="toast-title">hmm‚Ä¶ maybe?</div>
    <div class="toast-sub">
       i respect the suspense.<br>
  but i'm still rooting for yes üòâ
    </div>
    <button class="toast-reconsider" id="toast-close">fine‚Ä¶ one more look ‚Üí</button>
  </div>
</div>

<audio id="bg-music" loop>
  <source src="https://orangefreesounds.com/wp-content/uploads/2023/02/Romantic-background-music-intro.mp3" type="audio/mpeg"/>
</audio>


<script>
"use strict";
const $ = id => document.getElementById(id);
const clamp = (v,a,b) => Math.max(a, Math.min(b, v));
const rand = (a,b) => Math.random()*(b-a)+a;
const wait = ms => new Promise(r => setTimeout(r, ms));

(function initCursor(){
  const dot=$('cursor'), ring=$('cursor-ring');
  let mx=0,my=0, rx=0,ry=0;
  document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;});
  document.addEventListener('touchmove',e=>{mx=e.touches[0].clientX;my=e.touches[0].clientY;},{passive:true});
  (function loop(){
    rx+=(mx-rx)*.18; ry+=(my-ry)*.18;
    dot.style.left=mx+'px'; dot.style.top=my+'px';
    ring.style.left=rx+'px'; ring.style.top=ry+'px';
    requestAnimationFrame(loop);
  })();
})();

(function initAmbientHearts(){
  const canvas=$('heartCanvas'), ctx=canvas.getContext('2d');
  let W,H;
  const resize=()=>{W=canvas.width=innerWidth;H=canvas.height=innerHeight;};
  window.addEventListener('resize',resize); resize();
  function hptAt(t){ return {x:16*Math.pow(Math.sin(t),3),y:-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))}; }
  function drawHeart(cx,cy,sz,al,col){
    ctx.save(); ctx.globalAlpha=al; ctx.fillStyle=col; ctx.beginPath();
    for(let i=0;i<=62;i++){ const t=(i/62)*2*Math.PI,p=hptAt(t); i===0?ctx.moveTo(cx+p.x*sz,cy+p.y*sz):ctx.lineTo(cx+p.x*sz,cy+p.y*sz); }
    ctx.closePath(); ctx.fill(); ctx.restore();
  }
  const COLS=['#e8638a','#f7a8c4','#c0415f','#f9d0df'];
  const hearts=Array.from({length:25},()=>({
    x:rand(0,innerWidth), y:rand(0,innerHeight)+innerHeight,
    vx:rand(-.4,.4), vy:-rand(.25,.7),
    sz:rand(2,7), al:rand(.04,.18),
    col:COLS[~~rand(0,COLS.length)],
    wb:rand(0,Math.PI*2), ws:rand(.005,.025),
    depth:rand(.4,1.2)
  }));
  let pmx=0,pmy=0;
  document.addEventListener('mousemove',e=>{pmx=e.clientX;pmy=e.clientY;});
  (function tick(){
    ctx.clearRect(0,0,W,H);
    const ox=(pmx/W-.5)*20, oy=(pmy/H-.5)*10;
    hearts.forEach(h=>{
      h.wb+=h.ws; h.x+=h.vx+Math.sin(h.wb)*.35; h.y+=h.vy;
      if(h.y<-40){ h.y=H+40; h.x=rand(0,W); }
      drawHeart(h.x+ox*h.depth, h.y+oy*h.depth, h.sz, h.al, h.col);
    });
    requestAnimationFrame(tick);
  })();
})();

(function initSparkles(){
  const canvas=$('sparkCanvas'), ctx=canvas.getContext('2d');
  let W,H;
  const resize=()=>{W=canvas.width=innerWidth;H=canvas.height=innerHeight;};
  window.addEventListener('resize',resize); resize();
  const particles=[]; let mx=0,my=0,frame=0;
  document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;});
  function heartPath(cx,cy,sz){
    ctx.beginPath();
    for(let i=0;i<=40;i++){
      const t=(i/40)*2*Math.PI;
      const x=cx+16*Math.pow(Math.sin(t),3)*sz;
      const y=cy-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))*sz;
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.closePath();
  }
  (function tick(){
    ctx.clearRect(0,0,W,H); frame++;
    if(frame%3===0) particles.push({x:mx+rand(-8,8),y:my+rand(-8,8),vx:rand(-1.2,1.2),vy:rand(-1.8,-.2),life:1,decay:rand(.03,.07),sz:rand(.6,1.5),col:`hsl(${rand(330,360)},80%,${rand(75,90)}%)`});
    particles.forEach((p,i)=>{
      p.x+=p.vx; p.y+=p.vy; p.life-=p.decay;
      if(p.life<=0){particles.splice(i,1);return;}
      ctx.save(); ctx.globalAlpha=p.life*.6; ctx.fillStyle=p.col;
      heartPath(p.x,p.y,p.sz); ctx.fill(); ctx.restore();
    });
    requestAnimationFrame(tick);
  })();
})();

// DODGE SYSTEM ‚Äî Button dodges randomly across ENTIRE PAGE, heart drawn in card
(function initDodge(){
  const card=$('card'), noBtn=$('no-btn'), counter=$('dodge-counter'), dodgeMsg=$('dodge-msg');
  const cvs=$('cardTrailCanvas'), ctx=cvs.getContext('2d');

  function syncCanvas(){
    cvs.width=card.offsetWidth;
    cvs.height=card.offsetHeight;
  }
  window.addEventListener('resize',syncCanvas);
  setTimeout(syncCanvas,900);

  let dodgeActive=false;
  
  window.__enableDodge = () => {
    syncCanvas();
    
    // Get the YES button's position on screen
    const yesRect = $('yes-btn').getBoundingClientRect();
    
    // Position Maybe button to the right of Yes button (SCREEN coordinates since it's fixed)
    const initialLeft = yesRect.right + 16;
    const initialTop = yesRect.top;
    
    console.log('Initial button position:', initialLeft, initialTop);
    
    noBtn.style.left = initialLeft + 'px';
    noBtn.style.top = initialTop + 'px';
    
    // Make button visible and active
    noBtn.classList.add('active');
    
    // Small delay to ensure CSS is applied
    setTimeout(() => {
      dodgeActive = true;
      console.log('Dodge activated! Button should be visible at:', noBtn.style.left, noBtn.style.top);
    }, 50);
  };

  // Heart path in card-local coordinates (for drawing trail)
  function heartToCard(t){
    const cx=cvs.width*0.5, cy=cvs.height*0.52;
    const scl=Math.min(cvs.width,cvs.height)*0.038;
    const x=16*Math.pow(Math.sin(t),3);
    const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    return {x:cx+x*scl, y:cy+y*scl};
  }

  const TOTAL_STEPS=120;
  const TRIGGER_DIST=120; // detection radius
  const RUN_SPEED=2;

  let t=0, done=false, trailPts=[];

  // Move button to RANDOM position on screen (with padding)
  function dodgeToRandom(){
    const bW=noBtn.offsetWidth, bH=noBtn.offsetHeight;
    const padding=50;
    const newX=rand(padding, innerWidth-bW-padding);
    const newY=rand(padding, innerHeight-bH-padding);
    noBtn.style.left=newX+'px';
    noBtn.style.top=newY+'px';
  }

  function redrawTrail(){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    if(trailPts.length<2) return;
    for(let i=1;i<trailPts.length;i++){
      const pct=i/trailPts.length, p0=trailPts[i-1], p1=trailPts[i];
      ctx.save();
      ctx.globalAlpha=pct*0.25;
      ctx.strokeStyle='rgba(232,99,138,1)';
      ctx.lineWidth=10; ctx.shadowColor='rgba(232,99,138,0.8)'; ctx.shadowBlur=16; ctx.lineCap='round';
      ctx.beginPath(); ctx.moveTo(p0.x,p0.y); ctx.lineTo(p1.x,p1.y); ctx.stroke();
      ctx.restore();
      ctx.save();
      ctx.globalAlpha=0.4+pct*0.5;
      ctx.strokeStyle=`hsl(${338+pct*15},72%,${45+pct*18}%)`;
      ctx.lineWidth=2; ctx.lineCap='round';
      ctx.beginPath(); ctx.moveTo(p0.x,p0.y); ctx.lineTo(p1.x,p1.y); ctx.stroke();
      ctx.restore();
    }
  }

  let cursorX=-999, cursorY=-999;
  document.addEventListener('mousemove',e=>{cursorX=e.clientX;cursorY=e.clientY;});
  document.addEventListener('touchmove',e=>{cursorX=e.touches[0].clientX;cursorY=e.touches[0].clientY;},{passive:true});

  function distToCursor(){
    const r=noBtn.getBoundingClientRect();
    const bx=r.left+r.width/2, by=r.top+r.height/2;
    return Math.hypot(cursorX-bx, cursorY-by);
  }

  function tick(){
    if(!dodgeActive||done){ requestAnimationFrame(tick); return; }

    if(distToCursor()<TRIGGER_DIST){
      // Dodge to random position
      dodgeToRandom();
      
      // Draw heart trail
      for(let s=0;s<RUN_SPEED;s++){
        if(t>=TOTAL_STEPS) break;
        const angle=(t/TOTAL_STEPS)*2*Math.PI;
        const pos=heartToCard(angle);
        trailPts.push({x:pos.x,y:pos.y});
        t++;
        counter.classList.add('visible');
        counter.textContent=Math.round((t/TOTAL_STEPS)*100)+'%';
      }
      redrawTrail();
      if(t>=TOTAL_STEPS){ heartComplete(); return; }
    }
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  function heartComplete(){
    done=true;
    counter.textContent='complete ‚úì';
    redrawTrail();
    trailPts.forEach((p,i)=>{
      const pct=i/trailPts.length;
      ctx.save();
      ctx.globalAlpha=0.18;
      ctx.fillStyle=`hsl(340,80%,${60+pct*20}%)`;
      ctx.beginPath(); ctx.arc(p.x,p.y,3,0,Math.PI*2); ctx.fill();
      ctx.restore();
    });
    burstHearts(35);
    setTimeout(()=>{
      dodgeMsg.classList.add('visible');
      noBtn.classList.add('heart-done');
    },900);
    noBtn.addEventListener('click',()=>showMaybeToast(),{once:true});
    noBtn.addEventListener('touchend',()=>showMaybeToast(),{once:true});
  }
})();

function showMaybeToast(){ $('maybe-toast').classList.add('visible'); }
$('toast-close').addEventListener('click',()=>$('maybe-toast').classList.remove('visible'));
$('toast-close').addEventListener('touchend',e=>{e.preventDefault();$('maybe-toast').classList.remove('visible');});

$('yes-btn').addEventListener('click',triggerYes);
$('yes-btn').addEventListener('touchend',e=>{e.preventDefault();triggerYes();});

function triggerYes(){
  if($('success').classList.contains('visible')) return;
  
  // üéâ SEND EMAIL NOTIFICATION! üéâ
  sendEmailNotification();
  
  $('shimmer').classList.add('active');
  const music=$('bg-music');
  music.volume=0; music.play().catch(()=>{});
  let vol=0; const fi=setInterval(()=>{vol=Math.min(vol+.02,.5);music.volume=vol;if(vol>=.5)clearInterval(fi);},80);
  launchConfetti();
  document.body.style.transition='transform .6s cubic-bezier(.22,1,.36,1)';
  document.body.style.transform='scale(1.05)';
  const card=$('card');
  card.style.transition='opacity .6s,transform .6s';
  card.style.opacity='0'; card.style.transform='translateY(-20px) scale(.97)';
  ['dodge-counter','dodge-msg','no-btn'].forEach(id=>{
    const el=$(id); if(el){ el.style.transition='opacity .4s'; el.style.opacity='0'; }
  });
  burstHearts(60);
  setTimeout(()=>{
    $('success').classList.add('visible');
    document.body.style.transform='scale(1)';
  },700);
}

// ‚ú® EMAIL NOTIFICATION FUNCTION ‚ú®
function sendEmailNotification() {
  const now = new Date();
  const timeString = now.toLocaleString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  
  // Template parameters that match your EmailJS template
  const templateParams = {
    name: 'Chrisly',
    time: timeString,
    message: 'üéâ SHE SAID YES! üéâ'
  };
  
  // Send email using your service and template
  emailjs.send('service_tts96ov', 'template_5qg9d6g', templateParams)
    .then(function(response) {
      console.log('‚úÖ Email sent successfully!', response.status, response.text);
    }, function(error) {
      console.log('‚ùå Email failed to send:', error);
    });
}

function burstHearts(count=30){
  const words=['¬∑','‚Äî','‚ô°','√ó','‚àò'];
  for(let i=0;i<count;i++) setTimeout(()=>{
    const el=document.createElement('div');
    el.style.cssText=`position:fixed;z-index:350;pointer-events:none;font-size:${rand(10,22)}px;font-family:'Cormorant Garamond',serif;color:rgba(${rand(200,240)},${rand(100,160)},${rand(130,180)},${rand(0.4,0.8)});left:${rand(5,95)}vw;top:${rand(10,85)}vh;`;
    el.textContent=words[~~rand(0,words.length)];
    el.animate([{opacity:1,transform:`translateY(0) scale(1) rotate(${rand(-20,20)}deg)`},{opacity:0,transform:`translateY(-${rand(60,160)}px) scale(${rand(.5,1.2)}) rotate(${rand(-40,40)}deg)`}],{duration:rand(900,2000),easing:'ease-out',fill:'forwards'});
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),2500);
  },i*40);
}

function launchConfetti(){
  const cols=['#f7a8c4','#e8638a','#fde8ee','#ffb3c6','#ff4d6d','#ffd6e0'];
  for(let i=0;i<90;i++) setTimeout(()=>{
    const el=document.createElement('div'), sz=rand(5,14);
    el.className='confetti-bit';
    el.style.cssText=`width:${sz}px;height:${sz}px;left:${rand(10,90)}vw;top:-20px;background:${cols[~~rand(0,cols.length)]};border-radius:${Math.random()>.5?'50%':'3px'};`;
    el.animate([{transform:`translateY(0) rotate(0deg)`,opacity:1},{transform:`translateY(105vh) rotate(${rand(360,1080)}deg)`,opacity:0}],{duration:rand(1600,3000),easing:'linear',fill:'forwards'});
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),4000);
  },i*22);
}

(function initMusic(){
  const toggle=$('music-toggle'), mus=$('bg-music');
  let on=false;
  toggle.addEventListener('click',()=>{on=!on;on?(mus.play().catch(()=>{}),toggle.classList.add('playing'),toggle.textContent='‚ô¨'):(mus.pause(),toggle.classList.remove('playing'),toggle.textContent='‚ô™');});
  toggle.addEventListener('touchend',e=>{e.preventDefault();toggle.click();});
})();

const QUESTION="Would you like to go out with me this Valentine's Day?";
async function typeWriter(){
  const el=$('typewriter-text'), cur=$('tw-cursor');
  el.textContent='';
  for(let i=0;i<QUESTION.length;i++){
    el.textContent+=QUESTION[i];
    await wait(QUESTION[i]==='.'||QUESTION[i]==='?'?200:38);
  }
  await wait(3000); cur.classList.add('hidden');
}

async function runIntro(){
  setTimeout(()=>$('music-toggle').classList.add('visible'),1200);
  const steps=['step-1','step-2','step-3'];
  for(let i=0;i<steps.length;i++){
    await wait(i===0?600:200);
    $(steps[i]).classList.add('active');
    await wait(1900);
    $(steps[i]).classList.add('exiting');
    await wait(600);
    $(steps[i]).classList.remove('active','exiting');
  }
  $('intro').style.transition='opacity .7s'; $('intro').style.opacity='0';
  await wait(400); $('intro').style.display='none';
  const card=$('card');
  card.classList.add('visible');
  await wait(700);
  typeWriter();
  await wait(QUESTION.length*40+1200);
  window.__enableDodge();
}

window.addEventListener('load',runIntro);
</script>
</body>
</html>